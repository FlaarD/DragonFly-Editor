<h1>DragonFly Editor - Editor</h1>
<body onload="page_loaded()">

<?php
	#session_start();
	#$_SESSION['set']; <- itemSets des mecs qui ont uploadés
	
	#Ici commence la récupération
	define ("Original_Summoner_s_Rift", 1);
	define ("Twisted_Treeline", 10);
	define ("Summoner_s_Rift", 11);
	define ("Howling_Abyss", 12);
	
	
    $FR_item_list=file_get_contents('http://ddragon.leagueoflegends.com/cdn/5.2.1/data/en_US/item.json');
	$DecodedList = json_decode($FR_item_list, true);
	
	function display_Icon($ID, $classes=array("image_margin")){
		$display_classes = '';
		foreach ($classes as $class){
			$display_classes = $display_classes.' '.$class;
		}
		$image = '<span><img class="'.$display_classes.'" onmouseover="show_description('.$ID.')" onmouseout="hide_description('.$ID.')" src="http://ddragon.leagueoflegends.com/cdn/5.2.1/img/item/'.$ID.'.png" alt="texte alternatif" /></span>';
		echo $image;
	}
	
	function prepare_descriptions($item, $id){
		//Ajouter l'ID dans les class pour les personaliser dans le CSS pour l'affichage
		if (!empty($item['into']))
			$image = 'Leads to :<br/>';
		else
			$image = '';
		foreach ($item['into'] as $evolution){
			$image = $image.'<img class="image_margin" src="http://ddragon.leagueoflegends.com/cdn/5.2.1/img/item/'.$evolution.'.png" alt="texte alternatif" />';
		}
		$display = '<div id="'.$id.'" class="item_description">'.$item['name'].'<br/>'.$item['description'].'<br/>'.$image.'<br/></div>';
		echo $display;
	}
	
	function display_all_selected($ItemsList, $Maps = array(), $Tags = array()){
		//$currentItem = ID of the item
		//$value = data tab of the item. Data are also tabs or key/value tabs. 
		//$value['data'][index/key]
		
		$TrueItemData = $ItemsList['data'];
		echo '<div class="items_zone">';
		foreach($TrueItemData as $currentItem => $value){
			$IsDisplayed = true;
			$classes = array();
			prepare_descriptions($value, $currentItem);
			$DescriptionArray[] = $value['description'];
			//We do not need non-purchasable items for now.
			if (!$value['gold']['purchasable']){
				$IsDisplayed = false;
			}	
			else{	
				if (isset($value['maps'])){ //first test if the object has a map field. If not it is displayed because it means it is on all the maps.
					foreach ($value['maps'] as $itemMaps => $bool){
						switch($itemMaps){
							case 1 : $classes[] = 'OriginalSummonersRift';
							break;
							case 10 : $classes[] = 'TwistedTreeline';
							break;
							case 11 : $classes[] ='SummonersRift';
							break;
							case 12 : $classes[] = 'HowlingAbyss';
							break;
						}
					}
					if (!empty($Maps)){
						foreach($Maps as $PlayedMap){
							if(isset($value['maps'][$PlayedMap]) && !$value['maps'][$PlayedMap]){
								//echo "je passe et j'ignore : ".$value['name'].'<br/>';
								$IsDisplayed = false;
							}
						}
					}	
				}
				if (!empty($Tags)){
					$TagChoice = false;
					foreach($Tags as $chosenTag){
						if(!empty($value['tags']) && !$TagChoice){
							foreach($value['tags'] as $itemTag){
								$classes[] = $itemTag;
								if ($itemTag == $chosenTag){
									$TagChoice = true;
								}
							}
						}
					}
					var_dump($classes);
					if (!$TagChoice){
						$IsDisplayed = false;
					}
				}
				if ($IsDisplayed) {
					display_Icon($currentItem);
				}
			}
		}
		/*
		#$key contient les id
		#$value contient le tableau assoc de chaque item
		$key=
		$image = '<img src="http://ddragon.leagueoflegends.com/cdn/5.2.1/img/item/'.$key.'.png" alt="texte alternatif" />';
		$name = $value['name'];*/
		
	}
	$maps = array(Summoner_s_Rift, Original_Summoner_s_Rift);
	$tags = array('AttackSpeed');
	
	
	display_all_selected($DecodedList, $maps);

	
?>
</body>